{"version":3,"sources":["../src/analytics.js"],"names":[],"mappings":";;;;;;;AAAA;;AACA;;;;;;AAEO,IAAM,gCACX,SADW,SACX,CAAC,GAAD,EAAS;AACP,MAAM,OAAO,IAAI,GAAJ,CAAQ,MAAR,CAAb;AACA,MAAM,OAAO,IAAI,GAAJ,CAAQ,MAAR,KAAmB,WAAhC;AACA,MAAM,SAAS,KAAK,IAApB;AACA,MAAM,UAAU,gBAAK,MAAL,EAAgB,IAAhB,oBAAhB;;AAEA,MAAM,SAAS;AACb,OAAG;AADU,GAAf;;AAIA,MAAM,aAAa,CACjB,IAAI,kBAAQ,UAAR,CAAmB,IAAvB,CAA4B;AAC1B,cAAU,OADgB;AAE1B,WAAO,GAFmB;AAG1B,UAAM,IAHoB;AAI1B,aAAS,OAJiB,E;AAK1B,cAAU,EALgB;AAM1B,cAAU;AANgB,GAA5B,CADiB,CAAnB;;AAWA,MAAM,SAAS,IAAI,kBAAQ,MAAZ,CAAmB,EAAE,sBAAF,EAAc,cAAd,EAAnB,CAAf;;AAEA,MAAM,aACJ,SADI,UACJ,CAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAoB;AAAA,QACV,EADU,GACW,GADX,CACV,EADU;AAAA,QACN,MADM,GACW,GADX,CACN,MADM;AAAA,QACE,IADF,GACW,GADX,CACE,IADF;;AAElB,WAAO,CAAP,2CAEU,EAFV,4BAGY,MAHZ,0BAIU,IAJV;;AAOA;AACD,GAXH;;AAaA,MAAI,GAAJ,CAAQ,GAAR,EAAa,UAAb;AACD,CAtCI;;kBAwCQ,S","file":"analytics.js","sourceRoot":"./src/index.js","sourcesContent":["import { join } from 'path'\nimport winston from 'winston'\n\nexport const analytics =\n  (app) => {\n    const dirs = app.get('dirs')\n    const name = app.get('name') || 'magic-app'\n    const logDir = dirs.logs\n    const logFile = join(logDir, `${name}-analytics.log`)\n\n    const levels = {\n      a: 0,\n    }\n\n    const transports = [\n      new winston.transports.File({\n        filename: logFile,\n        level: 'a',\n        json: true,\n        maxsize: 5242880, // 5MB\n        maxFiles: 50,\n        colorize: false,\n      }),\n    ]\n\n    const logger = new winston.Logger({ transports, levels })\n\n    const logHandler =\n      (req, res, next) => {\n        const { ip, method, path } = req\n        logger.a(`\n          Access:\n          From: ${ip}\n          Method: ${method}\n          Path: ${path}\n        `)\n\n        next()\n      }\n\n    app.use('*', logHandler)\n  }\n\nexport default analytics\n"]}