{"version":3,"sources":["../../src/errors/handle404.js"],"names":[],"mappings":";;;;;;;AAAA;;;;AACA;;;;AAEA,IAAM,OAAO,SAAP,IAAO,GAAM,EAAN;;AAEN,IAAM,gCACX,SADW,SACX,CAAC,GAAD,EAAM,GAAN,EAA2B;MAAhB,6DAAO,oBAAS;;AACzB,MAAM,MAAM,IAAI,GAAJ,CADa;AAEzB,MAAM,OAAO,IAAI,GAAJ,CAAQ,SAAR,KAAsB,KAAtB,CAFY;AAGzB,MAAM,OAAO,IAAI,GAAJ,CAAQ,aAAR,KAA0B,KAA1B,CAHY;;AAKzB,2BAAI,IAAJ,uCAA6C,IAAI,MAAJ,CAAW,IAAX,CAA7C,CALyB;;AAOzB,MAAI,IAAJ,EAAU;AACR,0FAA0D,IAA1D,EADQ;AAER,WAAO,IAAI,QAAJ,CAAa,IAAb,CAAP,CAFQ;GAAV;;AAKA,MAAI,MAAJ,CAAW,IAAX,GAAkB,IAAlB,CAZyB;AAazB,MAAI,MAAJ,CAAW,GAAX,EAbyB;;AAezB,mBAAK,GAAL,EAAU,GAAV,EAAe,eAAO;AACpB,QAAI,GAAJ,EAAS;AACP,+BAAI,KAAJ,kCAAyC,IAAI,QAAJ,eAAzC,EADO;AAEP,aAAO,KAAK,GAAL,CAAP,CAFO;KAAT;GADa,CAAf,CAfyB;CAA3B;;kBAuBa","file":"handle404.js","sourceRoot":"./src/index.js","sourcesContent":["import log from 'magic-server-log';\nimport { page } from '../pages';\n\nconst noop = () => {};\n\nexport const handle404 =\n  (req, res, next = noop) => {\n    const app = req.app;\n    const p404 = app.get('404page') || '404';\n    const r404 = app.get('404redirect') || false;\n\n    log.warn(`404 error page called, page was: ${req.params.page}`);\n\n    if (r404) {\n      log(`magic-errorHandler r404 was set in host, redirect: ${r404}`);\n      return res.redirect(r404);\n    }\n\n    req.params.page = p404;\n    res.status(404);\n\n    page(req, res, err => {\n      if (err) {\n        log.error(`404 page template for host: ${req.hostname} not found`);\n        return next(err);\n      }\n    });\n  };\n\nexport default handle404;\n"]}