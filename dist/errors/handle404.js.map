{"version":3,"sources":["../../src/errors/handle404.js"],"names":[],"mappings":";;;;;;;AAAA;;;;AACA;;;;AAEA,IAAM,OAAO,SAAP,IAAO,GAAM,CAAE,CAArB;;AAEO,IAAM,gCACX,SADW,SACX,CAAC,GAAD,EAAM,GAAN,EAA2B;AAAA,MAAhB,IAAgB,yDAAT,IAAS;;AACzB,MAAM,MAAM,IAAI,GAAhB;AACA,MAAM,OAAO,IAAI,GAAJ,CAAQ,SAAR,KAAsB,KAAnC;AACA,MAAM,OAAO,IAAI,GAAJ,CAAQ,aAAR,KAA0B,KAAvC;;AAEA,2BAAI,IAAJ,uCAA6C,IAAI,MAAJ,CAAW,IAAxD;;AAEA,MAAI,IAAJ,EAAU;AACR,0FAA0D,IAA1D;AACA,WAAO,IAAI,QAAJ,CAAa,IAAb,CAAP;AACD;;AAED,MAAI,MAAJ,CAAW,IAAX,GAAkB,IAAlB;AACA,MAAI,MAAJ,CAAW,GAAX;;AAEA,yBAAW,GAAX,EAAgB,GAAhB,EAAqB,eAAO;AAC1B,QAAI,GAAJ,EAAS;AACP,+BAAI,KAAJ,kCAAyC,IAAI,QAA7C;AACA,aAAO,KAAK,GAAL,CAAP;AACD;AACF,GALD;AAMD,CAtBI;;kBAwBQ,S","file":"handle404.js","sourceRoot":"./src/index.js","sourcesContent":["import log from 'magic-server-log'\nimport { renderPage } from '../pages'\n\nconst noop = () => {}\n\nexport const handle404 =\n  (req, res, next = noop) => {\n    const app = req.app\n    const p404 = app.get('404page') || '404'\n    const r404 = app.get('404redirect') || false\n\n    log.warn(`404 error page called, page was: ${req.params.page}`)\n\n    if (r404) {\n      log(`magic-errorHandler r404 was set in host, redirect: ${r404}`)\n      return res.redirect(r404)\n    }\n\n    req.params.page = p404\n    res.status(404)\n\n    renderPage(req, res, err => {\n      if (err) {\n        log.error(`404 page template for host: ${req.hostname} not found`)\n        return next(err)\n      }\n    })\n  }\n\nexport default handle404\n"]}